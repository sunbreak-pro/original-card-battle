# 手記（Journal）システム実装計画書

## 変更履歴

| 日付       | バージョン | 内容               |
| ---------- | ---------- | ------------------ |
| 2026-02-04 | v1.0       | 初版作成           |

---

## 1. 背景と目的

### 1.1 現状の問題

BaseCamp が 7 施設で構成されており、設計が複雑化している。
各施設の操作ボリュームに偏りがあり、薄い施設が複数存在する。

| 施設               | 主な操作                               | 操作ボリューム |
| ------------------ | -------------------------------------- | -------------- |
| 酒場 (Guild)       | キャラ選択・残機確認・状況サマリー     | 薄い           |
| 取引所 (Shop)      | 装備購入・売却・魔石換金               | 中程度         |
| 鍛冶屋 (Blacksmith)| 強化・修理・解体                       | 中程度         |
| 神殿 (Sanctuary)   | スキルツリー解放                       | 中程度         |
| 図書館 (Library)   | デッキ編成・図鑑・セーブロード         | 散漫           |
| 倉庫 (Storage)     | アイテム整理                           | 薄い           |
| ダンジョンゲート   | 深度選択・出発                         | 薄い           |

特に**図書館**は「デッキ編成・装備セット保存・図鑑・セーブロード」と関連性の薄い機能の寄せ集めになっている。

### 1.2 解決方針

図書館を施設として廃止し、ヘッダーに常駐する**「手記（Journal）」UI**に統合する。

設計上の分離軸は以下の通り：

- **手記 = 精神・記憶の領域**（デッキ編成、図鑑、攻略メモ、設定）
- **インベントリ = 肉体・物質の領域**（装備セット、アイテム管理）

手記はプレイヤーの「記憶や思考」に関わる機能を集約する。
装備やアイテムといった「物質」は手記には含めず、インベントリ側に限定する。

---

## 2. 手記のコンセプト

### 2.1 世界観上の位置づけ

孤独な探索者が持ち歩く**個人の手記**。

主人公は一人で深淵に潜る。手記は唯一の対話相手であり、敵の情報を記録し、戦術を練り、カードの組み合わせを考える場所。全ての機能が「生き延びるための行為」として手記のメタファーに収まる。

### 2.2 トーン

ゲーム全体のダークファンタジーのトーンを維持する。
明るさや軽快さは不要。暗い紙面、滲んだインク、孤独感のある表現。

---

## 3. ヘッダーへの統合設計

### 3.1 配置方針

既存の `resource-frame`（残機・Gold・魔石）の横並び構造を**一切崩さない**。
手記アイコンを resource-frame の**外側・左**に追加する。

```
[タイトル]  |  [📖]  |  [❤️❤️❤️]  [🪙 1200G]  [小魔石×3] [中×1] [大×0] [極×0]
               ↑手記     ↑既存の resource-frame（変更なし）
```

手記アイコンと resource-frame の間はセパレータ（縦線 or gap）で視覚的に区切る。

- **操作系:** 手記アイコン（左側）
- **情報系:** リソース表示群（右側・既存）

### 3.2 手記アイコンの状態表現

| 状態                 | 表現                                                             |
| -------------------- | ---------------------------------------------------------------- |
| 通常                 | ダークトーンの本アイコン。静止。                                 |
| 出撃準備時           | アイコン周囲に暗い赤紫の脈動（pulse）。戦術ページ確認を促す。   |
| ダンジョン内         | アイコンがわずかに暗くなる。開けるが編集制限あり。               |
| 新情報追記時         | アイコン右上に赤いドットバッジ。確認後に消える。                 |

出撃準備時の脈動は「デッキを最終確認しろ」という無言の警告として機能する。

### 3.3 オーバーレイ開閉

手記アイコンをクリックすると、**画面中央にオーバーレイ**として手記が開く。

- 背景は半透明の黒で暗転
- 画面遷移ではない（どの施設にいても、ダンジョン内でも同じ挙動）
- ESC キーまたは手記の外側クリックで閉じる

```
┌─ 手記オーバーレイ ───────────────────────────┐
│                                               │
│   [戦術]   [記憶]   [思考]   [設定]           │  ← ページタブ
│  ───────────────────────────────────────────  │
│                                               │
│             （各ページの内容）                  │
│                                               │
│                                               │
│                                    [✕ 閉じる] │
└───────────────────────────────────────────────┘
```

タブは本のしおりをイメージした横並び。
ページめくりアニメーションは将来の UIUX 強化フェーズに回し、現段階ではシンプルなタブ切り替えとする。

---

## 4. 手記のページ構成

```
手記（Journal）
├── 第一章「戦術」  ── デッキ編成
├── 第二章「記憶」  ── 図鑑（カード / 装備 / 魔物）
├── 第三章「思考」  ── 攻略メモ（自由記述）
└── 奥付「設定」    ── セーブ/ロード / 音量 / 表示設定
```

---

### 4.1 第一章「戦術」— デッキ編成

手記の最初のページ。探索前に戦術を練る場所。
カードを並べて配置を考える行為が「手記に戦術を書き込む」フレーバーになる。

**拠点での機能：**

- 所持カード一覧の閲覧
- デッキへのカード追加・除外
- デッキ枚数・コスト分布の確認
- キャラクター別のデッキ切り替え
- 出撃準備時にページが光る UI 演出（最終確認ポイント）

**ダンジョン内での制限：**

- 閲覧のみ。現在のデッキ構成を確認できるが編集は不可。
- フレーバーテキスト：*「今さら戦術を変えることはできない…」*

**ルール：**

- ダンジョン出撃後、カードの編成は不可能。
- 出撃前の最終確認を促すため、ダンジョンゲート画面で手記アイコンが脈動する。

**UI イメージ（将来の UIUX 強化時）：**

手記の見開きページ。左ページにカード一覧（インク書きの文字リスト風）、右ページにデッキスロット。拠点では墨が乗る（編集可能）、ダンジョン内では墨が薄れている（読み取り専用）。

---

### 4.2 第二章「記憶」— 図鑑

探索で出会ったもの、倒したもの、手にしたものの記録。
「記憶」というタイトルは、手記に残した記録＝探索者の記憶そのものというメタファー。

3 つの節に分かれる：

**2-1. カード図鑑**

- 入手済みカードの効果・ステータス閲覧
- 未入手カードはシルエット表示（存在だけ匂わせる）
- カード間のシナジー情報（発見済みのもの）

**2-2. 装備図鑑**

- 入手したことのある装備の情報
- 強化段階ごとのスキル情報
- 未入手装備は「???」

**2-3. 魔物図鑑**

- 倒した敵：行動パターン・弱点・ドロップ情報を完全表示
- 遭遇のみの敵：外見・基本 HP・ドロップのみ
- 未遭遇の敵：ページが空白（*「まだ何も記されていない…」*）

**ダンジョン内での挙動：**

- 全て閲覧可能。戦闘前に敵情報を確認する行為は戦術として自然。
- 新たに遭遇・撃破した敵の情報は**戦闘終了時にリアルタイム追記**される。
- 追記時の演出：*「新たな記憶が刻まれた…」*（ドットバッジがヘッダーに表示）

---

### 4.3 第三章「思考」— 攻略メモ

プレイヤーが自由にテキストを書き込めるページ。
手記の世界観を最も強く体現する部分。

**機能：**

- 自由テキスト入力（複数ページ作成可能）
- ページにタイトルを付けられる
- 簡易的なマークダウン対応（太字・リスト程度）
- ページの並べ替え・削除

**想定される使い方：**

- ボスの攻略パターンのメモ
- 「深度 3 は装備 Lv2 以上で挑む」のような自分ルール
- デッキ構成のアイデアメモ
- 次の探索の目標

**ダンジョン内での挙動：**

- 閲覧・書き込みともに可能。探索中にメモを取る行為は自然。
- ダンジョン内で書いた内容は即座に保存される。

**UI イメージ（将来の UIUX 強化時）：**

罫線の入った黄ばんだ紙面。インクの色は暗い赤茶色。新しい書き込みはインクが濡れている演出。古いメモは少し滲んでいる。

---

### 4.4 奥付「設定」

本の最後のページに設定を配置。
「奥付」という位置づけにすることで、ゲーム設定がメタ的に浮かない。

**拠点での機能：**

- セーブ / ロード（手動スロット 3 つ程度）
- 音量調整（BGM / SE）
- 表示設定（アニメーション速度、テキスト速度）
- 操作設定

**ダンジョン内での制限：**

- セーブ：限定的（方針は未決定。下記 5.2 参照）
- ロード：不可（巻き戻し防止）
- 音量・表示設定は変更可能

---

## 5. アクセス権限まとめ

### 5.1 拠点 vs ダンジョン内

| ページ             | 拠点       | ダンジョン内             |
| ------------------ | ---------- | ------------------------ |
| 戦術（デッキ編成） | 閲覧・編集 | **閲覧のみ**             |
| 記憶（図鑑）       | 閲覧       | 閲覧＋リアルタイム追記   |
| 思考（攻略メモ）   | 閲覧・編集 | 閲覧・編集               |
| 奥付（設定）       | 全機能     | セーブ限定・ロード不可   |

### 5.2 ダンジョン内セーブの方針（未決定）

以下のいずれかを選択する必要がある：

| 案  | 方針                   | 内容                                                 | 方向性           |
| --- | ---------------------- | ---------------------------------------------------- | ---------------- |
| A   | 完全不可               | ダンジョン内ではセーブ不可。中断＝一時停止のみ。     | ハードコア寄り   |
| B   | 特定ポイントのみ       | 休憩部屋など特定の場所でのみセーブ可能。             | バランス型       |
| C   | 中断セーブ             | セーブ可能だがロード時にセーブデータ消去。            | カジュアル寄り   |

→ **次回決定事項**

---

## 6. 実装範囲

### 6.1 変更するファイル

| ファイル                 | 変更内容                                           |
| ------------------------ | -------------------------------------------------- |
| `FacilityHeader.tsx`     | 手記アイコンの追加（resource-frame の外側・左）     |
| `FacilityHeader.css`     | アイコンのスタイル、pulse アニメーション            |

### 6.2 新規作成するファイル

| ファイル                 | 内容                                               |
| ------------------------ | -------------------------------------------------- |
| `Journal.tsx`            | 手記オーバーレイ本体（タブ切替＋各ページ）          |
| `Journal.css`            | オーバーレイのスタイル                              |
| `JournalContext.tsx`     | 開閉状態・現在タブ・ダンジョン内フラグの管理        |

### 6.3 触らないファイル

- `resource-frame` 内部の HTML 構造と CSS
- 既存の `gold-frame`, `magic-stone-frame`, `remaining-life` のスタイル
- `BaseCamp.tsx` の施設グリッド部分

### 6.4 施設側の変更

図書館施設を廃止する。図書館が担っていた機能の移行先：

| 旧・図書館の機能     | 移行先                         |
| -------------------- | ------------------------------ |
| デッキ編成           | 手記 → 第一章「戦術」          |
| 装備セット保存       | インベントリ側（手記には含めない）|
| 図鑑（カード/装備/魔物）| 手記 → 第二章「記憶」        |
| セーブ/ロード        | 手記 → 奥付「設定」            |

---

## 7. 未決定事項

| 項目                       | 内容                                              | 優先度 |
| -------------------------- | ------------------------------------------------- | ------ |
| ダンジョン内セーブ方針     | 案 A / B / C のいずれか（5.2 参照）               | 高     |
| 施設全体の統合方針         | 残りの施設（酒場・取引所・鍛冶屋・倉庫等）の統合  | 中     |
| 手記アイコンの画像アセット | ダークトーンの本アイコンの制作                     | 低     |
| ページめくりアニメーション | 将来の UIUX 強化フェーズで対応                     | 低     |

---

## 8. 設計原則

本計画を通じて守る設計原則：

1. **手記＝精神、インベントリ＝肉体**の分離を徹底する。
2. 既存のヘッダーリソース表示を崩さない。
3. ダンジョン内での手記アクセスは「戦術行為」として自然な範囲に限定する。
4. ダークファンタジーのトーンを維持する。明るさや軽快さは不要。
5. 現段階では UIUX の装飾よりロジック完成を優先する。
