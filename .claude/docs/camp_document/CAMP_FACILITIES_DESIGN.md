# BaseCamp 統合設計書 V3.0

## 更新履歴

- V3.0: **新設計への完全移行** - 持ち帰り型ダンジョン RPG、魂の残滓経験値化、探索回数制限追加
- V2.0: 設計思想重視に刷新、Sanctuary/Library 追加、Church/Training 削除

---

## 1. 設計思想

### 1.1 BaseCamp の役割

BaseCamp は、持ち帰り型ダンジョン探索の合間に訪れる「安息と準備の場」です。

**3 つの核となるコンセプト:**

1. **準備 (Preparation)**: 次の探索に向けた戦力強化
2. **成長 (Progression)**: 探索間での恒久的な進歩
3. **管理 (Management)**: リソース・装備・デッキの整理

**V3.0 での大幅変更:**

```
旧: ローグライト要素（死んで強くなる）
新: 持ち帰り型（生還して成長する）

- 死亡ペナルティの明確化
- 魂の残滓 = 経験値システム
- 探索回数制限の追加
```

### 1.2 設計原則

**明確な機能分離:**

- 各施設は独立した明確な役割を持つ
- 機能の重複を避け、相互補完する設計
- プレイヤーが迷わない直感的な配置

**段階的な複雑性:**

- 序盤は単純な操作（購入・強化）
- 中盤で戦略性（デッキ編成・品質上昇）
- 終盤で最適化（恒久強化・ビルド研究）

**持ち帰り型要素の統合:**

- ラン内進行: Gold、装備レベル、カード獲得
- ラン間進行: 魂の残滓（経験値）による恒久強化
- 情報蓄積: 図鑑・戦績による知識の蓄積
- 探索回数制限: 各探索に重みを持たせる

---

## 2. 施設構成

### 2.1 施設一覧

BaseCamp は以下の 6 施設で構成されます：

| 施設       | 英名         | 主な役割                       | 進行タイプ |
| ---------- | ------------ | ------------------------------ | ---------- |
| 酒場       | Guild        | キャラクター選択・探索回数確認 | ラン開始   |
| 取引所     | Shop         | 装備・アイテムの売買           | ラン内     |
| 鍛冶屋     | Blacksmith   | 装備の強化・修理・解体         | ラン内     |
| 神殿       | Sanctuary    | 魂の残滓による恒久強化         | ラン間     |
| 図書館     | Library      | デッキ編成・図鑑・記録         | 管理       |
| ダンジョン | Dungeon Gate | 深淵への入口                   | 探索開始   |

### 2.2 施設間の関係性

```
【探索の流れ】
Guild → Dungeon → 戦闘・報酬 → 生還 or 死亡
  ↓                                  ↓
キャラ選択                    Shop/Blacksmith（装備強化）
探索回数確認                         ↓
                              Library（デッキ調整）
                                    ↓
                              Sanctuary（魂で強化）
                                    ↓
                              次の探索 or 終了

【生還・死亡の違い】
生還: Gold・魔石・装備・魂を持ち帰り → 強化
死亡: 探索分を全ロスト（累計魂は保持） → BaseCamp分は保持

【探索回数制限】
10回以内に深層到達が必須
生還・死亡にかかわらず +1
制限超過 → ゲームオーバー
```

---

## 3. 各施設の機能概要

### 3.1 Guild（酒場）

**コンセプト:** 冒険の起点

**主な機能:**

- キャラクター選択（Swordsman / Mage / Summoner）
- ステータス確認
- **探索回数の確認（V3.0 - NEW）**
- クエスト受注（将来拡張）

**V3.0 での変更:**

```
探索回数表示:
「探索回数: 7 / 13 (残り6回)」
※13 = デフォルト10 + Sanctuary強化+3

警告:
「残り回数が少なくなっています！」
```

**詳細:** `GUILD_DESIGN_V2.1.md` 参照（要修正）

---

### 3.2 Shop（取引所）

**コンセプト:** 経済の中心

**主な機能:**

- 消耗品・転移石の購入
- 装備パック（ガチャ要素）
- 装備の売却
- 魔石 →Gold の換金
- ~~日替わりセール~~（V3.0 - 削除）

**V3.0 での変更:**

```
削除:
- 日替わりセール
  理由: 探索回数制限があるため、時間経過要素は不要

強調:
- 装備購入の重要性
- 死亡時のリカバリー手段
```

**リソースフロー:**

```
探索報酬（Gold/魔石） → Shop購入 → 戦力向上
不要装備 → 売却/解体 → Gold/魔石 → 再投資
```

**詳細:** `SHOP_DESIGN_V1.md` 参照（要軽微修正）

---

### 3.3 Blacksmith（鍛冶屋）

**コンセプト:** 装備の極限強化

**主な機能:**

- 装備レベルアップ（Lv0-3）
- 品質上昇システム（poor → normal → good → master）
- 魔石クオリティによるガチャ要素
- 装備修理（AP 回復）
- 装備解体（魔石還元）

**V3.0 での変更:**

```
変更なし（既存設計を維持）

ただし、戦略性の変化:
- 高レベル装備は死亡時に全ロスト
- リスク管理の重要性が増加
```

**成長の軸:**

```
装備性能 = baseStats × 品質補正 × レベル補正
```

**戦略性:**

- 通常強化: 低コスト、低確率
- 品質重視: 中コスト、高確率、最低保証あり
- 最高品質: 高コスト、最高確率、上位保証

**詳細:** `BLACKSMITH_DESIGN_V1.md` 参照（変更なし）

---

### 3.4 Sanctuary（神殿）

**コンセプト:** 魂による恒久的成長

**V3.0 での大幅変更:**

```
旧: 死亡時に魂獲得 → 恒久強化（ローグライト）
新: 魔物撃破で魂獲得（経験値） → 生還で累計加算 → 恒久強化
```

**主な機能:**

- 魂の残滓を消費したスキルツリー解放
- ラン間で永続する強化
- プレイヤーの基礎能力向上

**魂の残滓システム（V3.0 - 経験値化）:**

```
【獲得方法】
魔物撃破時:
- 雑魚: 5魂
- 強敵: 15魂
- ボス: 50魂

【生還時】
この探索で獲得した魂 × 生還方法倍率 → 累計に加算
- 帰還ルート: 100%
- 通常転移石: 70%
- 祝福転移石: 80%
- 緊急転移石: 60%

【死亡時】
この探索で獲得した魂 → ゼロ
累計魂 → 保持（変化なし）
```

**スキルツリー構造:**

```
中心ノード（無料解放済み）
  ↓
第1層: 基礎強化（HP+10, Gold+10%など）
  ↓
第2層: 専門化（クラス特化、特殊効果、探索回数+1）
  ↓
第3層: 究極強化（大幅なボーナス、探索回数+2）
```

**重要な新スキル（V3.0 - NEW）:**

- **探索の延長 I**: 探索回数 +1（コスト 80 魂）
- **探索の延長 II**: 探索回数 +2（累計+3、コスト 150 魂）

**設計意図:**

- 魔物を倒すモチベーション
- 生還の価値を大幅に向上
- 死亡は痛いが、累計は保持（完全リセットではない）
- 探索回数拡張で戦略の幅が広がる

**詳細:** `SANCTUARY_DESIGN_V2.md` 参照

---

### 3.5 Library（図書館）

**コンセプト:** 知識と記録の殿堂

**主な機能:**

1. **デッキ編成**: カード・装備・アイテムの組み合わせ
2. **図鑑**: カード・装備・アイテム・魔物の記録
3. **戦績**: 称号、達成度
4. **記憶の間**: セーブ/ロード

**4 つの本棚:**

**📖 編成の書:**

- デッキ構築（カード選択）
- 装備セット選択
- 初期アイテム選択
- ロードアウト保存/読込（セット 1, 2, 3）

**📕 図鑑の書:**

- カード図鑑（熟練度・進化情報）
- 装備図鑑（レアリティ・効果）
- アイテム図鑑（消耗品・魔石）
- 魔物図鑑（出現深度・ドロップ）

**📘 戦績の書:**

- 称号システム
- 達成度（クリア回数、最深到達など）
- 統計情報（**探索回数も記録 - V3.0**）

**📗 記憶の間:**

- セーブデータ管理（複数スロット）
- クラウド同期（将来拡張）
- データエクスポート

**V3.0 での変更:**

```
統計情報に追加:
- 総探索回数
- 生還回数
- 死亡回数
- 平均獲得魂
```

**設計意図:**

- ビルド研究の場
- プレイヤーの進歩を可視化
- 試行錯誤を促す

**詳細:** `LIBRARY_DESIGN_V1.md` 参照（要軽微修正）

---

### 3.6 Dungeon Gate（深淵の入口）

**コンセプト:** 探索への扉

**主な機能:**

- 深度選択（1-5）
- 難易度確認
- **探索回数の確認（V3.0 - NEW）**
- 探索開始

**V3.0 での変更:**

```
探索開始前の確認画面:
「探索を開始しますか？」
探索回数: 7 / 13 (残り6回)

深度5（深淵）への警告:
「深淵では生還手段が無効化されます」
「探索回数: 残り6回」
「本当に進みますか？」
```

**UI 特徴:**

- 不気味で魅力的なビジュアル
- 深度ごとに色が変わる（1:灰緑 → 5:深紫）
- 探索回数の警告表示

---

## 4. リソースエコノミー

### 4.1 リソースの種類と流れ（V3.0）

```
【ラン内リソース（一時的）】
Gold: 探索報酬 → Shop購入/Blacksmith強化/修理
      生還 → 持ち帰り（方法により減少）
      死亡 → ゼロ

魔石: 敵ドロップ → Blacksmith強化/Shop換金
      生還 → 持ち帰り（方法により減少）
      死亡 → ゼロ

装備: Shop/ドロップ → Blacksmith強化 → 解体
      生還 → 持ち帰り
      死亡 → 全ロスト（BaseCamp保管分は保持）

AP: 戦闘消耗 → Blacksmith修理
    生還 → そのまま
    死亡 → -

【ラン間リソース（恒久的）】
魂の残滓:
  獲得: 魔物撃破時（経験値的）
  生還 → この探索分を累計に加算（方法により減少）
  死亡 → この探索分はゼロ（累計は保持）
  使用: Sanctuary恒久強化

【情報リソース（記録型）】
図鑑: 発見 → Library記録 → 戦略構築
```

### 4.2 経済バランスの設計（V3.0）

**序盤（探索 1-3 回目）:**

- Gold は少ない、魔石も希少
- Shop 中心の装備調達
- 死亡を避けて確実に生還
- 魂を蓄積

**中盤（探索 4-7 回目）:**

- 魂が増え始める
- Sanctuary 強化が重要に
- Blacksmith 強化本格化
- リスク・リターンの判断

**終盤（探索 8-10 回目）:**

- 資源は潤沢だが、探索回数が少ない
- 生還の価値が極めて高い
- Sanctuary で最終強化
- 深層への挑戦

---

## 5. 進行システムの統合（V3.0）

### 5.1 ラン内進行（一時的）

**流れ:**

```
1. Guild: キャラクター選択、探索回数確認
2. Dungeon: 探索開始
3. 戦闘: 報酬獲得（Gold, 魔石, 装備, 魂）
4. 生還判断: 転移石 or 帰還ルート or 深層へ
5. 生還 → BaseCamp帰還
   - Shop: 装備購入/売却
   - Blacksmith: 強化/修理
   - Library: デッキ調整
   - Sanctuary: 魂で恒久強化
6. 次の探索 or クリア/死亡
```

### 5.2 ラン間進行（恒久的 - V3.0）

**生還時:**

```
1. 獲得: Gold、魔石、装備、魂の残滓
2. Sanctuary: スキルツリー解放
3. 探索回数: +1
4. Guild: 次の探索へ（強化済みステータス）
```

**死亡時:**

```
1. ロスト: この探索で獲得したGold、魔石、装備、魂
2. 保持: BaseCampのGold、装備、累計魂、カード
3. 探索回数: +1
4. Guild: 次の探索へ（BaseCamp資源で再挑戦）
```

**探索回数制限:**

```
デフォルト: 10回
Sanctuary強化: +1, +2（最大+3）

残り回数が少ない → 生還の価値が急上昇
制限超過 → ゲームオーバー
```

### 5.3 知識の蓄積（メタ進行）

**Library 図鑑:**

- カード熟練度: 使用回数で解禁
- 装備図鑑: 入手で解禁
- 魔物図鑑: 遭遇で解禁

**戦略的価値:**

- 未知の要素を減らす
- 効果的なビルドを研究
- プレイヤースキルの向上

---

## 6. UI/UX 統合方針

### 6.1 画面遷移

```
BaseCamp（メイン画面）
├─ Guild（探索回数表示）
├─ Shop
├─ Blacksmith
├─ Sanctuary（累計魂・探索魂表示）
├─ Library
│  ├─ Deck Builder
│  ├─ Encyclopedia
│  ├─ Achievements（探索回数統計）
│  └─ Save/Load
└─ Dungeon Gate（探索回数確認） → Battle Screen
```

### 6.2 共通 UI パターン

**ヘッダー:**

- 常時表示: Gold, **探索回数（V3.0 - NEW）**
- 施設名
- 戻るボタン

**リソース表示:**

- 施設ごとに関連リソースを強調
- Shop: Gold, 魔石価値
- Blacksmith: Gold, 魔石価値
- Sanctuary: **累計魂、この探索の魂（V3.0）**
- Library: なし（情報のみ）
- Guild: **探索回数（V3.0）**

**配色:**

- BaseCamp: 温かみのある茶色・オレンジ
- Guild: 賑やかな酒場の雰囲気
- Shop: 金貨の輝き
- Blacksmith: 炎と鉄の赤
- Sanctuary: 神聖な白・金
- Library: 落ち着いた青・紫

---

## 7. 拡張性の考慮

### 7.1 Phase 分けの方針

**Phase 1（MVP）:**

- Guild: キャラクター選択、探索回数表示
- Shop: 基本購入・売却
- Blacksmith: 強化・修理（品質はシンプル）
- Sanctuary: 基礎スキルツリー（10-15 ノード、探索回数+1）
- Library: デッキ編成、基本図鑑
- Dungeon: 深度 1-3
- 探索回数制限システム

**Phase 2（拡張）:**

- Guild: クエストシステム
- Blacksmith: 品質ガチャ要素の洗練
- Sanctuary: 第 2 層スキル追加（探索回数+2）
- Library: 称号システム
- Dungeon: 深度 4-5

**Phase 3（完成）:**

- 全施設の最終調整
- バランス調整
- エンドコンテンツ
- Sanctuary: 第 3 層スキル（究極強化）

### 7.2 将来的な施設追加の可能性

**潜在的な拡張施設:**

- アリーナ（PvP/チャレンジモード）
- ギャラリー（アート・ストーリー）
- 工房（カスタマイズ）

**追加時の原則:**

- 既存施設の機能を侵食しない
- 明確な新規価値を提供
- BaseCamp の設計思想に沿う

---

## 8. 技術的考慮事項

### 8.1 Context API 設計

**共有 Context:**

- GameStateContext: 画面遷移、ゲーム全体の状態
- PlayerContext: Gold、ステータス、魂の残滓（V3.0）、**探索回数（V3.0 - NEW）**
- InventoryContext: 装備、アイテム、魔石

**施設別ローカル state:**

- 各施設は独自のローカル state で管理
- 施設間で Context は不要（過度な複雑化を避ける）

### 8.2 データ永続化

**セーブデータ構造:**

```typescript
{
  player: {
    gold: number,
    sanctuaryProgress: {
      currentRunSouls: number,  // V3.0: 一時的
      totalSouls: number,        // V3.0: 恒久的
      unlockedNodes: string[],
      explorationLimitBonus: number // V3.0: NEW
    },
    explorationLimit: {          // V3.0: NEW
      max: number,
      current: number
    }
    // ...
  },
  inventory: Item[],
  library: {
    cardMastery: Map<cardId, level>,
    encyclopedia: {
      cards: Set<cardId>,
      equipment: Set<equipmentId>,
      monsters: Set<monsterId>
    },
    achievements: Set<achievementId>,
    statistics: {
      totalExplorations: number,  // V3.0: NEW
      survivalCount: number,      // V3.0: NEW
      deathCount: number,         // V3.0: NEW
      avgSoulsGained: number      // V3.0: NEW
    }
  },
  // ...
}
```

---

## 9. まとめ

### 9.1 設計の核心（V3.0）

BaseCamp は、以下の 3 つの柱で構成されます：

1. **戦術的準備**（Guild, Shop, Blacksmith, Library）

   - 次の探索に向けた即時的な準備
   - ラン内でのリソース管理
   - **探索回数の確認と管理**

2. **戦略的成長**（Sanctuary）

   - ラン間での恒久的な進歩
   - **魂の残滓（経験値）による強化**
   - **探索回数の拡張**

3. **知識の蓄積**（Library）
   - 情報の記録と可視化
   - プレイヤースキルの向上支援

### 9.2 V3.0 での根本的変更

**ゲームジャンルの変更:**

```
Roguelike → 持ち帰り型ダンジョンRPG
```

**魂の残滓システム:**

```
死亡時獲得 → 魔物撃破時獲得（経験値）
生還で累計加算、死亡で探索分ゼロ
```

**探索回数制限:**

```
10回以内に深層到達
Sanctuaryで+1, +2拡張可能
生還・死亡の重みが増加
```

**生還・死亡の明確化:**

```
生還: 全て持ち帰り（リターン）
死亡: 探索分ロスト、累計保持（リスク管理）
```

### 9.3 設計の成功指標

**良い設計の証:**

- プレイヤーが各施設の役割を即座に理解できる
- ラン間で成長を実感できる
- **生還のタイミングが戦略的判断になる**
- **探索回数制限が緊張感を生む**
- 探索 → 帰還 → 強化のループが心地よい
- BaseCamp 自体が楽しい「遊び場」になる

---

## 10. 参照ドキュメント

**施設別詳細設計:**

```
BASE_CAMP_DESIGN_V3 [本文書]
├── GUILD_DESIGN_V2.1.md（要修正）
├── SHOP_DESIGN_V1.md（要軽微修正）
├── BLACKSMITH_DESIGN_V1.md（変更なし）
├── SANCTUARY_DESIGN_V2.md（V3.0対応）
└── LIBRARY_DESIGN_V1.md（要軽微修正）
```

**上位設計:**

```
GAME_DESIGN_MASTER_V2.md（全体設計書）
└── return_system_v2.md（生還システム）
```

**関連システム:**

- battle_logic.md（戦闘システム）
- card_system.md（カードシステム）
- dungeon_system.md（ダンジョンシステム - 要作成）

---

**設計書 更新者への注意:**

- この文書は**設計思想とコンセプト**を記述する場所です
- 具体的な実装詳細は各施設の個別設計書に記載してください
- 新施設を追加する際は、既存施設との関係性を明確にしてください
- 常に「なぜこの設計なのか」を意識して記述してください
- **V3.0 では持ち帰り型ダンジョン RPG への移行が最重要課題です**
